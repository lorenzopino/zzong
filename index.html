<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Songwriting Game</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        /* Optional: Add minimal custom styles if needed */
        body {
            background-color: #f8f9fa; /* Light grey background */
        }
        .phase-title {
            margin-bottom: 1.5rem;
            color: #6c757d; /* Muted color */
        }
        .step-card {
            margin-bottom: 1.5rem;
        }
         .list-group-item span {
            font-weight: bold;
            color: #fd5f00; /* Accent color from spec */
         }
    </style>
</head>
<body>

    <div id="app" class="container mt-4">
        <h1 class="mb-3">The Songwriting Game</h1>
        <hr>

        <div v-if="currentPhase === 1">
            <h2 class="phase-title">Phase 1: Sonic Core Definition</h2>

            <div class="card step-card" v-if="currentStep === 1.1">
                <div class="card-body">
                    <h5 class="card-title">Step 1.1: Generate Musical Context</h5>

                    <div v-if="!contextGenerated && !contextConfirmed">
                        <p>Let's define the musical foundation for your track.</p>
                        <button class="btn btn-primary" @click="generateContext">
                            Generate Key, Scale & Tempo
                        </button>
                    </div>

                    <div v-if="contextGenerated && !contextConfirmed">
                        <p>Here's the suggested musical context:</p>
                        <ul class="list-group mb-3">
                            <li class="list-group-item">Key: <span>{{ framework.key }}</span></li>
                            <li class="list-group-item">Scale/Mode: <span>{{ framework.scale }}</span> <small>({{ getScaleDefinition(framework.scale) }})</small></li>
                            <li class="list-group-item">Tempo: <span>{{ framework.tempo }} BPM</span></li>
                        </ul>
                        <p>Like it? Confirm to lock it in, or generate again.</p>
                        <button class="btn btn-success me-2" @click="confirmContext">
                            Confirm Context
                        </button>
                        <button class="btn btn-secondary" @click="generateContext">
                            Generate Again
                        </button>
                    </div>

                    <div v-if="contextConfirmed">
                         <p class="alert alert-success">
                             Musical context confirmed:
                             <strong>{{ framework.key }} {{ framework.scale }}</strong> at <strong>{{ framework.tempo }} BPM</strong>.
                         </p>
                         <p>Now, let's create the first instrument layer.</p>
                         <button class="btn btn-info" disabled>Next: Create Layer 1 (WIP)</button>
                    </div>
                </div>
            </div>

            <div class="card step-card" v-if="currentStep === 1.2">
                 <div class="card-body">
                     <h5 class="card-title">Step 1.2: Generate Initial Layers (Work in Progress)</h5>
                     <p>Display Layer 1 generation options here...</p>
                     <p>Context: {{ framework.key }} {{ framework.scale }}, {{ framework.tempo }} BPM</p>
                      <button class="btn btn-secondary" @click="goBackToContext">Back to Context</button> </div>
            </div>
            </div> </div> <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

    <script>
        const { createApp, ref, reactive } = Vue;

        createApp({
            data() {
                return {
                    currentPhase: 1,
                    currentStep: 1.1, // Start at step 1.1
                    framework: reactive({ // Use reactive for nested object changes
                        key: null,
                        scale: null,
                        tempo: null
                    }),
                    contextGenerated: false,
                    contextConfirmed: false,
                    // --- Data Lists (from specifications) ---
                    musicalKeys: ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'],
                    musicalScales: [
                        { name: 'Major', definition: 'Standard happy/bright scale' },
                        { name: 'Natural Minor', definition: 'Standard sad/dark scale' },
                        { name: 'Harmonic Minor', definition: 'Minor scale with a raised 7th, gives an exotic feel' },
                        { name: 'Melodic Minor', definition: 'Minor scale with raised 6th and 7th ascending' },
                        { name: 'Dorian', definition: 'Minor-like mode, often jazzy or melancholic' },
                        { name: 'Phrygian', definition: 'Minor-like mode, Spanish/dark feel' },
                        { name: 'Lydian', definition: 'Major-like mode, dreamy/ethereal feel' },
                        { name: 'Mixolydian', definition: 'Major-like mode, bluesy/dominant feel' },
                        { name: 'Pentatonic Major', definition: 'Simple 5-note major scale, common in folk/rock' },
                        { name: 'Pentatonic Minor', definition: 'Simple 5-note minor scale, common in blues/rock' },
                        { name: 'Blues Scale', definition: 'Pentatonic minor with an added flat 5th, very bluesy' }
                    ],
                    tempoRange: { min: 70, max: 125 },
                    // --- State for future steps (example) ---
                    layers: reactive([]) // Array to hold layer objects
                }
            },
            methods: {
                // --- Helper Methods ---
                getRandomInt(min, max) {
                    min = Math.ceil(min);
                    max = Math.floor(max);
                    return Math.floor(Math.random() * (max - min + 1)) + min; // Inclusive
                },
                getRandomElement(arr) {
                    if (!arr || arr.length === 0) return null;
                    const randomIndex = Math.floor(Math.random() * arr.length);
                    return arr[randomIndex];
                },

                // --- Step 1.1 Methods ---
                generateContext() {
                    console.log("Generating context...");
                    const selectedScaleObject = this.getRandomElement(this.musicalScales);

                    this.framework.key = this.getRandomElement(this.musicalKeys);
                    this.framework.scale = selectedScaleObject ? selectedScaleObject.name : null; // Store only the name
                    this.framework.tempo = this.getRandomInt(this.tempoRange.min, this.tempoRange.max);

                    this.contextGenerated = true;
                    this.contextConfirmed = false; // Reset confirmation status if regenerating
                },
                confirmContext() {
                    console.log("Context confirmed:", this.framework);
                    this.contextConfirmed = true;
                     // --- Advance State ---
                     // In a real app you might have more complex logic here
                     // For now, let's just enable moving to the next conceptual step
                     // We will change currentStep when the user explicitly starts Layer 1 generation
                     // this.currentStep = 1.2; // Let's trigger this later
                },
                getScaleDefinition(scaleName) {
                    const scaleObj = this.musicalScales.find(s => s.name === scaleName);
                    return scaleObj ? scaleObj.definition : 'Unknown scale';
                },

                 // --- Navigation/Debugging Methods ---
                goToNextStep() { // Example function to manually advance step if needed
                   if (this.currentStep === 1.1 && this.contextConfirmed) {
                       this.currentStep = 1.2;
                   }
                   // Add logic for other steps later
                },
                goBackToContext() { // Example function to go back
                    if (this.currentStep === 1.2) {
                        this.currentStep = 1.1;
                        // Decide if you want to reset confirmation status or allow re-confirmation
                        // this.contextConfirmed = false;
                        // this.contextGenerated = false; // Or keep generated context visible?
                    }
                }

                // --- Methods for Step 1.2 (Layers) will go here ---

            },
            mounted() {
                console.log("Vue App Mounted!");
                // You could potentially load saved state here in the future
            }
        }).mount('#app');
    </script>

</body>
</html>